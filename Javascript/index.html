<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title></title>

	<link rel="stylesheet" href="content/stylesheet.css" />

    <script src="scripts/lib/require-2.1.20.min.js"></script>
    <script src="scripts/main.js"></script>
</head>
<body>

<div class="" style="text-align: center;">
	<span data-bind="text: display.description"></span><br/>
	<input type="button" value="pause" data-bind="value: pauseLabel, click: togglePause" />
	<input type="button" value="monkey!" data-bind="value: monkeyLabel, click: toggleMonkey" />
</div>

<div class="container">

	<!--
	<div class="log right">
		<b>Message Log</b>
		<!-- ko foreach: logContents -- >
		<div data-bind="text: $data"></div>
		<!-- /ko -- >
	</div>
	-->

	<div class="log">
		<span class="log-title">Expectations Log</span><br />
		<table>
			<tbody data-bind="foreach: externalResults">
				<tr>
					<!--<td data-bind="text: category"></td>-->
					<td data-bind="text: status" valign="top"></td>
					<td data-bind="text: text" valign="top" style="overflow: hidden;"></td>
				</tr>
			</tbody>
		</table>
	</div>

	<div class="network-container">
		<div class="network-gateway">
			Network<br/>Gateway
		</div>

		<!-- ko foreach: network.nodes -->
		<div class="node" data-bind="style: { top: display.y() + 'px', left: display.x() + 'px' }, css: { 'node-status-online': status() == 'Online', 'node-status-offline': status() == 'Offline' }">
			<div class="node-name" data-bind="text: display.description"></div>
			<div class="node-queue">
				Action:
				<!-- ko if: display.incomingValueAction -->
				<div data-bind="text: display.incomingValueAction" class="node-storage-slot"></div>
				<!-- /ko -->
				<div data-bind="ifnot: display.incomingValueAction, visible: display.incomingValueAction() == null" class="node-storage-slot-empty">n/a</div>
			</div>
			<div class="node-storage">
				Storage:
				<!-- ko foreach: storage -->
				<div data-bind="text: display.description" class="node-storage-slot"></div>
				<!-- /ko -->
				<div data-bind="if: storage().length == 0, visible: storage().length == 0" class="node-storage-slot-empty">empty</div>
			</div>
		</div>
		<!-- /ko -->

		<!-- ko foreach: network.messages -->
			<div data-bind="text: display.description, deliverMessage: $data" class="message" style="position: absolute;"></div>
		<!-- /ko -->
	</div>
</div>
</body>
<script type="text/javascript">

require(["knockout",
		 "app/Constants",
		 "app/Settings",
		 "app/ViewModel" ],
function(ko,
		 CONST,
		 Settings,
		 ViewModel ){
	
	var sqlAzureSim = new Settings({
		// simulation settings
		messageDeliveryTime:	750,
		messageAtNodeDelay:		0,

		// network settings
		networkCommunications:	CONST.NetworkCommunications.GatewaySendsToPrimary,
		networkElectionStyle:	CONST.NetworkElectionStyle.Polled,
		
		// node settings
		nodeElectionStyle:		null,
		nodeAdditionStyle:		null,
		
		// network operations + monitoring
		networkMonitoringTime:	10000,
		timeUntilOfflineNodeIsRemoved: -1,	// never remove bad nodes
		
		// monkey settings
		maximumOfflineNodeRepairTime:	10000,
		minimumTimeBetweenOutages:		30000
	});

	
	var width = $(".network-container").width();
	var height = $(".network-container").height();
	var vm = new ViewModel(sqlAzureSim, 3, width, height);
	ko.applyBindings(vm);

	vm.startExternalMessageGeneration({
		"D0": [],
		"D1": [],
		"D2": [],
		"D3": [],
		"D4": []
	});
});

</script>
</html>
